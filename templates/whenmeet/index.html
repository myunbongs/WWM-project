{% load static %}
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title></title>
  <link rel="stylesheet" type="text/css" href="{% static 'css/group_timetable.css' %}" />

</head>

<body>
  <div class="total">

    <br>

    <div class="title-wrap" style="position: relative;z-index:2;">
      <div class="title"></div>
      <div class="titleText">
        <p><b> {{groupname}} 스케줄 스페이스 </b></p>

        <div id="dateBox">
          {{startdate}} ~ {{enddate}}
        </div>
      </div>
    </div>


    <script language="javascript" type="text/javascript">
      // 날짜 데이터 총 개수 
      var day_count = {{ date| length}};

      // 날짜 데이터 배열 
      var day = {{ date| safe}};


      document.write("<table border='1' width='100%'>"); //타이틀
      document.write("<tr bgcolor ='gray'>");
      document.write("<th>" + "</th>");
      for (var i = 0; i <= 23; i++) {
        document.write("<th>" + (i) + "</th>");
      }
      document.write("</tr>");


      //백엔드에서 주는 정보
      var date = day_count;
      //var day=["2022-08-16","2022-08-17","2022-08-18","2022-08-19","2022-08-20","2022-08-21","2022-08-22"];

      // var timetable=[[],[],['인식'],['지훈','지훈'],['지훈','지훈','지훈'],['지훈','지훈','지훈','인식'],['지훈','지훈','지훈','지훈','지훈'],['지훈','지훈','지훈','지훈','지훈','지훈'],['지훈','지훈','지훈','지훈','지훈','지훈','지훈'],['지훈','지훈','지훈','지훈','지훈','지훈','지훈','지훈'],['지훈','지훈','지훈','지훈','지훈','지훈','지훈','지훈','지훈'],['지훈','지훈','지훈','지훈','지훈','지훈','지훈','지훈','지훈','지훈'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],
      // [],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],
      // [],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],
      // [],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],
      // [],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],
      // [],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],
      // [],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],[],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식'],[],['지훈'],['지훈','인식']];

      var timetable = {{ timetable| safe}};

      var a = 0;
      var max_member = 2;

      console.log(timetable);
      for (var i = 0; i <= date - 1; i++) //행반복
      {
        console.log(1);
        document.write("<th>" + day[i] + "</th>");
        for (var j = 0; j <= 23; j++) //열반복
        {
          var mouseOver = "this.innerHTML=" + '"' + String(timetable[a]) + '"'; 
          var mouseOut = "this.innerHTML=" + '"' + '"';   

          if (timetable[a].length == 0) {
            document.write("<td bgcolor='white'>" + "</td>");
          }
          else if (timetable[a].length == 1) {
            document.write("<td bgcolor='#E1E1FF' onmouseover='" + mouseOver + "'" + 
            "onmouseout='" + mouseOut + "'" +
            ">" + "</td>");
          }
          else if (timetable[a].length == 2) {
            document.write("<td bgcolor='#C8C8FF' onmouseover='" + mouseOver + "'" + 
            "onmouseout='" + mouseOut + "'" +
            ">" + "</td>");
          }
          else if (timetable[a].length == 3) {
            document.write("<td bgcolor='#AFAFFF' onmouseover='" + mouseOver + "'" + 
            "onmouseout='" + mouseOut + "'" +
            ">" + "</td>");
          }
          else if (timetable[a].length == 4) {
            document.write("<td bgcolor='#9696FF' onmouseover='" + mouseOver + "'" + 
            "onmouseout='" + mouseOut + "'" +
            ">" + "</td>");
          }
          else if (timetable[a].length == 5) {
            document.write("<td bgcolor='#7D7DFF' onmouseover='" + mouseOver + "'" + 
            "onmouseout='" + mouseOut + "'" +
            ">" + "</td>");
          }
          else if (timetable[a].length == 6) {
            document.write("<td bgcolor='#6464FF' onmouseover='" + mouseOver + "'" + 
            "onmouseout='" + mouseOut + "'" +
            ">" + "</td>");
          }
          else if (timetable[a].length == 7) {
            document.write("<td bgcolor='#4B4BFF' onmouseover='" + mouseOver + "'" + 
            "onmouseout='" + mouseOut + "'" +
            ">" + "</td>");
          }
          else if (timetable[a].length == 8) {
            document.write("<td bgcolor='#3232FF' onmouseover='" + mouseOver + "'" + 
            "onmouseout='" + mouseOut + "'" +
            ">" + "</td>");
          }
          else if (timetable[a].length == 9) {
            document.write("<td bgcolor='#1919FF' onmouseover='" + mouseOver + "'" + 
            "onmouseout='" + mouseOut + "'" +
            ">" + "</td>");
          } else {
            document.write("<td bgcolor='#0000FF' onmouseover='" + mouseOver + "'" + 
            "onmouseout='" + mouseOut + "'" +
            ">" + "</td>");
          }
          // else{
          //     for(var k=1; k<=max_member; k++){
          //         if(timetable[a].length==1){
          //           rgb=k
          //           document.write("<td bgcolor='rgb,rgb,rgb'>");
          //           }
          //       }
          // }
          a = a + 1;

        }

        document.write("</tr>");
      }
      document.write("</table>");

      var result = {{ result_list| safe}}; //[3,149,172]

      var result_time = [];
      var result_day = [];

      for (var i = 0; i <= result.length; i++) {
        result_time[i] = parseInt(result[i] % 24) //시간
        result_day[i] = parseInt(result[i] / 24) //날짜
      }
      console.log(result_time);
      console.log(result_day);

      //  time은 겹쳐도 노상관, day가 같을 때 하나 씹어줘야 함 
      // result_time=[3,5,6,9,11,12];
      // result_day=[0,0,0,6,6,7];

      var str = ''
      const dic = {};
      result_day.forEach((x) => {
        dic[x] = (dic[x] || 0) + 1;
      });

      var i = 0;
      var count = 0;
      for (var key in dic) {
        console.log("key : " + key + ", value : " + dic[key]);
        if (day[key] != null) {
          str += day[key] + " ";
        }
        for (i = 0; i < dic[key]; i++) {
          if (result_time[count + i] != null && !isNaN(result_time[count + i])) {
            str += String(result_time[count + i]) + "시 ";
            console.log(count + i)
          }
        }
        count += i;
      }

      console.log(str);

    </script>


    <div class="result-time">
      <p>최대 인원 {{result_count}}명이 만날 수 있는 시간은 <span id="result"></span>입니다.</p>
      <br>
    </div>

    <script>
      var str_result = document.getElementById('result');
      str_result.innerText = str; 
    </script>

    <div class="btns">
      <button id="out-btn" onclick="window.location.href='http://127.0.0.1:8000/wwmgroup/{{wwmgroupurl}}/leave'">그룹 나가기</button>
        {% if laeder_email == user_email %}
            <button id="invite-btn">그룹원 초대</button>
            <button id="transfer-btn">방장 양도</button>
        {% endif %}
    </div>

  </div>
  <div class="modal">
    <div class="modal_body">
      <div id="modal_text"></div><br>
      <button id="modal_Yesbtn">예</button>
      <button id="modal_closedbtn">아니오</button>
    </div>

    <script type="text/javascript"> var user_count = "{{user_count}}"; var date = "{{date}}"; var wwmgroupurl = {{wwwmgroupurl}}; </script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
    <script src="{% static 'js/group_timetable.js' %}"></script>

</body>

</html>